<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="665px" preserveAspectRatio="none" style="width:1027px;height:665px;" version="1.1" viewBox="0 0 1027 665" width="1027px" zoomAndPan="magnify"><defs><filter height="300%" id="f15abtelkhym3w" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[3105e977017215c62956ee5c147722ae]
class policy--><rect fill="#F8F8F8" filter="url(#f15abtelkhym3w)" height="103.9922" id="policy" style="stroke: #383838; stroke-width: 1.5;" width="893" x="64.5" y="8"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="35" x="493.5" y="24.1387">policy</text><line style="stroke: #383838; stroke-width: 1.5;" x1="65.5" x2="956.5" y1="31.9688" y2="31.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="70.5" y="46.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="198.5" y="46.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="326.5" y="46.1792">PRIMARY KEY</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="529" x="422.5" y="46.1792">// the id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="32" x="70.5" y="58.9839">policy</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="198.5" y="58.9839">varchar(3145728)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="326.5" y="58.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="378" x="422.5" y="58.9839">// the access control policy in aperture language; base64 encoded</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="70.5" y="71.7886">policy_in_json</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="198.5" y="71.7886">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="326.5" y="71.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="406" x="422.5" y="71.7886">// the complied version of aperture access control policy in json format</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="70.5" y="84.5933">previous_policy</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="198.5" y="84.5933">varchar(3145728)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="326.5" y="84.5933">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="431" x="422.5" y="84.5933">// the previous access control policy in aperture language; base64 encoded</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="73" x="70.5" y="97.3979">last_updated</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="198.5" y="97.3979">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="326.5" y="97.3979">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="253" x="422.5" y="97.3979">// the time when the policy was last updated</text><line style="stroke: #383838; stroke-width: 1.5;" x1="65.5" x2="956.5" y1="103.9922" y2="103.9922"/><!--MD5=[606c0e9a527600b962089599cf14ab26]
class token--><rect fill="#F8F8F8" filter="url(#f15abtelkhym3w)" height="219.2344" id="token" style="stroke: #383838; stroke-width: 1.5;" width="1010" x="6" y="172"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="36" x="493" y="188.1387">token</text><line style="stroke: #383838; stroke-width: 1.5;" x1="7" x2="1015" y1="195.9688" y2="195.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="12" y="210.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="210.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="210.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="382" x="332" y="210.1792">// the consumer's email in lower case to whom the token is issued</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="12" y="222.9839">token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="222.9839">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="222.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="224" x="332" y="222.9839">// the sha256 hash of the access token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="34" x="12" y="235.7886">expiry</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="140" y="235.7886">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="235.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="332" y="235.7886">// token expiry time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="12" y="248.5933">request</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="248.5933">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="248.5933">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="428" x="332" y="248.5933">// the actual request sent by the consumer when this token was requested</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="12" y="261.3979">cert_serial</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="261.3979">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="261.3979">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="452" x="332" y="261.3979">// the serial number of consumer's certificate which was used to get this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="12" y="274.2026">cert_fingerprint</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="274.2026">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="274.2026">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="463" x="332" y="274.2026">// the sha1 fingerprint of consumer's certificate which was used to get this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="12" y="287.0073">issued_at</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="140" y="287.0073">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="287.0073">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="239" x="332" y="287.0073">// the time at which this token was issued</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="12" y="299.812">resource_ids</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="299.812">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="299.812">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="302" x="332" y="299.812">// the list of resource ids for which this token is valid</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="12" y="312.6167">introspected</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="140" y="312.6167">boolean</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="312.6167">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="483" x="332" y="312.6167">// true if ths token has been introspected/checked by a resource server atleast once</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="12" y="325.4214">revoked</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="140" y="325.4214">boolean</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="325.4214">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="309" x="332" y="325.4214">// true if the token has been revoked by the consumer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="12" y="338.2261">cert_class</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="40" x="140" y="338.2261">integer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="338.2261">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="440" x="332" y="338.2261">// the certificate class of the consumer which was used to request this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="12" y="351.0308">server_token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="351.0308">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="351.0308">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="283" x="332" y="351.0308">// a dictionary of sha256 hashes of server-tokens</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="12" y="363.8354">providers</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="363.8354">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="363.8354">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="678" x="332" y="363.8354">// a dictionary of providers for which this token is valid. providers[P] = false if the token was revoked by the provider P</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="12" y="376.6401">geoip</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="376.6401">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="376.6401">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="362" x="332" y="376.6401">// the output of geoip lookup using the npm package : geoip-lite</text><line style="stroke: #383838; stroke-width: 1.5;" x1="7" x2="1015" y1="383.2344" y2="383.2344"/><!--MD5=[0d2656fadf7191851afd801497368241]
class groups--><rect fill="#F8F8F8" filter="url(#f15abtelkhym3w)" height="91.1875" id="groups" style="stroke: #383838; stroke-width: 1.5;" width="829" x="96.5" y="451"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="44" x="489" y="467.1387">groups</text><line style="stroke: #383838; stroke-width: 1.5;" x1="97.5" x2="924.5" y1="474.9688" y2="474.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="102.5" y="489.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="198.5" y="489.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="294.5" y="489.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="529" x="390.5" y="489.1792">// the id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="102.5" y="501.9839">consumer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="198.5" y="501.9839">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="294.5" y="501.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="216" x="390.5" y="501.9839">// the consumer's email in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="102.5" y="514.7886">group_name</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="198.5" y="514.7886">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="294.5" y="514.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="220" x="390.5" y="514.7886">// the name of the group in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="102.5" y="527.5933">valid_till</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="198.5" y="527.5933">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="294.5" y="527.5933">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="310" x="390.5" y="527.5933">// indicates how long a consumer is to be in the group</text><line style="stroke: #383838; stroke-width: 1.5;" x1="97.5" x2="924.5" y1="534.1875" y2="534.1875"/><!--MD5=[e6ebd47dfd9b394ed517a8f9d34bd03e]
class crl--><rect fill="#F8F8F8" filter="url(#f15abtelkhym3w)" height="52.7734" id="crl" style="stroke: #383838; stroke-width: 1.5;" width="493" x="264.5" y="602"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="15" x="503.5" y="618.1387">crl</text><line style="stroke: #383838; stroke-width: 1.5;" x1="265.5" x2="756.5" y1="625.9688" y2="625.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="270.5" y="640.1792">crl</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="302.5" y="640.1792">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="366.5" y="640.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="158" x="462.5" y="640.1792">DEFAULT VALUE = '[]'::jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="97" x="654.5" y="640.1792">// CRL of IUDX CA</text><line style="stroke: #383838; stroke-width: 1.5;" x1="265.5" x2="756.5" y1="646.7734" y2="646.7734"/><!--MD5=[f4865c0efd73d94b3f0b9eb1aa734669]
link policy to token--><!--MD5=[ded119f31d0e8159f5dafa27dfb53545]
link token to groups--><!--MD5=[7291062458606fc17de4a2b597c0a9e9]
link groups to crl--><!--MD5=[c8e8a83403afb3ac9357f36dd446d13b]
@startuml
skinparam monochrome true
hide circle

entity policy {
	id				varchar			PRIMARY KEY	// the id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case
	policy			varchar(3145728)	NOT NULL		// the access control policy in aperture language; base64 encoded
	policy_in_json		jsonb				NOT NULL		// the complied version of aperture access control policy in json format
	previous_policy		varchar(3145728)	NOT NULL		// the previous access control policy in aperture language; base64 encoded
	last_updated		timestamp			NOT NULL		// the time when the policy was last updated 
}

entity token {
	id				varchar		NOT NULL		// the consumer's email in lower case to whom the token is issued
	token				varchar		NOT NULL		// the sha256 hash of the access token
	expiry			timestamp		NOT NULL		// token expiry time
	request			jsonb			NOT NULL		// the actual request sent by the consumer when this token was requested
	cert_serial			varchar		NOT NULL		// the serial number of consumer's certificate which was used to get this token
	cert_fingerprint		varchar		NOT NULL		// the sha1 fingerprint of consumer's certificate which was used to get this token 
	issued_at			timestamp		NOT NULL		// the time at which this token was issued
	resource_ids		jsonb			NOT NULL		// the list of resource ids for which this token is valid
	introspected		boolean		NOT NULL		// true if ths token has been introspected/checked by a resource server atleast once
	revoked			boolean		NOT NULL		// true if the token has been revoked by the consumer
	cert_class			integer		NOT NULL		// the certificate class of the consumer which was used to request this token
	server_token		jsonb			NOT NULL		// a dictionary of sha256 hashes of server-tokens
	providers			jsonb			NOT NULL		// a dictionary of providers for which this token is valid. providers[P] = false if the token was revoked by the provider P
	geoip				jsonb			NOT NULL		// the output of geoip lookup using the npm package : geoip-lite
}

entity groups {
	id			varchar		NOT NULL		// the id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case
	consumer		varchar		NOT NULL		// the consumer's email in lower case
	group_name	varchar		NOT NULL		// the name of the group in lower case
	valid_till		timestamp		NOT NULL		// indicates how long a consumer is to be in the group
}

entity crl {
	crl	jsonb		NOT NULL		DEFAULT VALUE = '[]'::jsonb		// CRL of IUDX CA
}

policy -[hidden]- token 
token -[hidden]- groups 
groups -[hidden]- crl
@enduml

PlantUML version 1.2020.07(Sun Apr 19 17:12:40 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+18-Ubuntu-1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>